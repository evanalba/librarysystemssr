<h2 class="list-head">Book List</h2>

<% if (books && books.length> 0) { %>
  <table class="table">
    <tbody>
      <% books.forEach(book=> { %>
        <tr>
          <td>
            <img src="<%= book.image_url %>" alt="<%= book.title %>" width="88" height="110" />
          </td>
          <td>
            <a href="/books/<%= book.id %>"><b>
                <%= book.title %>
              </b></a> <br />
            <%= book.authors %> <br />
              <%= book.publication_year %>
                <br />
                <% if (book.available_copies> 0) { %>
                  <span class="available">Available</span>
                  <% } else { %>
                    <span class="unavailable">Unavailable</span>
                    <% } %>
          </td>
          <% if (user && user.role==="admin" ) { %>
            <td class="admin-btns">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
                data-book-id="<%= book.id %>">Edit</button>
              <br>
              <br>
              <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal"
                data-book-id="<%= book.id %>">Delete</button>
            </td>
            <% } %>
        </tr>
        <% }); %>
    </tbody>
  </table>
  <% } else { %>
    <p class="no-books"><b>No books found in the library.</b></p>
    <% } %>
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content rounded-0">
            <div class="modal-header">
              <h1 class="modal-title fs-5">Edit Book</h1>
              <button type="button" class="btn-close opacity-100" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/books/edit/:id" method="POST">
              <div class="modal-body">
                <%- include("../../partials/book-form.ejs") %>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content rounded-0">
            <div class="modal-header">
              <h1 class="modal-title fs-5">Confirm Deletion</h1>
              <button type="button" class="btn-close opacity-100" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/books/delete/:id" method="POST">

              <div class="modal-body">
                <p>Are you sure you want to delete this book?</p>
              </div>
              <div class="modal-footer book-foot">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-danger">Yes, Delete Permanently</button>
              </div>

            </form>
          </div>
        </div>
      </div>